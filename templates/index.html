<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wi-Fi Pay — Оплата доступа</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .tariff-card { transition: all 0.2s ease; cursor: pointer; border-width: 2px; }
        .tariff-card.active { border-color: #3b82f6; background-color: #f0f7ff; }
        .hidden-section { display: none; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- Основная карточка -->
    <div class="bg-white rounded-[2.5rem] shadow-sm p-8 w-full max-w-[440px] border border-gray-100">
        
        <!-- Иконка Wi-Fi -->
        <div class="flex justify-center mb-4">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 20H12.01M8.5 16.5C9.42826 15.5717 10.687 15.0503 12 15.0503C13.313 15.0503 14.5717 15.5717 15.5 16.5M5 13C6.85652 11.1435 9.37392 10.1005 12 10.1005C14.6261 10.1005 17.1435 11.1435 19 13M1.5 9.5C4.28261 6.71739 8.05652 5.15076 12 5.15076C15.9435 5.15076 19.7174 6.71739 22.5 9.5" stroke="#3b82f6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </div>

        <h1 class="text-xl font-bold text-gray-900 mb-1 text-center">Высокоскоростной Wi-Fi</h1>
        <p class="text-gray-400 text-sm mb-8 text-center px-4">Выберите время доступа и оплатите картой любого банка</p>

        <!-- Список тарифов -->
        <div class="space-y-3 mb-6">
            <div onclick="selectTariff(100, this)" class="tariff-card flex items-center justify-between p-4 border-gray-200 rounded-2xl">
                <span class="font-semibold text-gray-800">1 Час доступа</span>
                <span class="font-bold text-gray-900 text-lg">100 ₸</span>
            </div>

            <div onclick="selectTariff(500, this)" class="tariff-card flex items-center justify-between p-4 border-gray-200 rounded-2xl">
                <span class="font-semibold text-gray-800">Весь день</span>
                <span class="font-bold text-gray-900 text-lg">500 ₸</span>
            </div>
        </div>

        <!-- Секция оплаты -->
        <div id="payment-section" class="hidden-section">
            <div class="h-[1px] bg-gray-100 w-full mb-6"></div>
            
            <div class="flex justify-between items-center mb-6 px-1">
                <span class="text-gray-600">К оплате:</span>
                <span id="final-amount" class="text-xl font-bold text-gray-900">0 ₸</span>
            </div>

            <button onclick="startPay()" id="pay-button" class="w-full bg-[#1c75ff] hover:bg-blue-600 text-white font-bold py-4 rounded-2xl flex items-center justify-center gap-3 transition-colors shadow-lg shadow-blue-100">
                <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/></svg>
                ОПЛАТИТЬ КАРТОЙ
            </button>

            <!-- Исправленные логотипы Visa/Mastercard -->
            <div class="flex justify-center items-center gap-6 mt-6 opacity-80">
                <img src="https://upload.wikimedia.org/wikipedia/commons/5/5e/Visa_Inc._logo.svg" height="20" width="45" alt="Visa">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" height="20" width="35" alt="Mastercard">
            </div>
        </div>

        <div class="text-gray-300 text-[10px] text-center mt-8 uppercase tracking-widest">
            ID: <span id="id-display">{{ mac }}</span>
        </div>
    </div>

    <!-- Футер -->
    <div class="mt-12 w-full max-w-[440px] text-center">
        <div class="h-[1px] bg-gray-200 w-full mb-6 opacity-40"></div>
        <div class="text-gray-800 font-bold text-[12px] mb-3 uppercase tracking-wider">ИП КАЛКИЕВ</div>
        <div class="flex justify-center space-x-6 text-[11px] font-medium text-blue-500 mb-8">
            <a href="/payment_methods">Оплата и Возврат</a>
            <a href="/offer">Оферта</a>
            <a href="/privacy">Приватность</a>
        </div>
        <div class="text-gray-400 text-[10px]">© 2026 Wi-Fi Pay.</div>
    </div>

    <!-- SDK Freedom Pay (обязательно перед скриптом) -->
    <script src="https://api.paybox.money/js/pbox.js"></script>
    <script>
        let selectedAmount = 0;

        function selectTariff(amount, el) {
            selectedAmount = amount;
            document.querySelectorAll('.tariff-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            
            document.getElementById('payment-section').style.display = 'block';
            document.getElementById('final-amount').innerText = amount + ' ₸';
        }

        async function startPay() {
            const payButton = document.getElementById('pay-button');
            payButton.innerText = "ЗАГРУЗКА...";
            payButton.disabled = true;

            try {
                const formData = new FormData();
                formData.append('amount', selectedAmount);
                formData.append('mac', "{{ mac }}");
                formData.append('router_id', "{{ router_id }}");

                const response = await fetch('/create_payment', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error("Ошибка сервера");

                const data = await response.json();

                // Вызов ФРЕЙМА (Виджета)
                const paybox = new Paybox(data);
                paybox.create();
            } catch (e) {
                alert("Ошибка при создании платежа: " + e.message);
            } finally {
                payButton.innerText = "ОПЛАТИТЬ КАРТОЙ";
                payButton.disabled = false;
            }
        }
    </script>
</body>
</html>